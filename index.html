<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#ff4d6d" />
  <title>Happy Valentine‚Äôs Day ‚ù§Ô∏è</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#110612;
      --bg2:#2a1025;
      --bg3:#3a1230;
      --card:rgba(255,255,255,.12);
      --card-2:rgba(255,255,255,.2);
      --stroke:rgba(255,255,255,.2);
      --pink:#ff4d86;
      --pink-2:#ff96b4;
      --pink-3:#ffd0de;
      --text:#fff;
      --text-soft:rgba(255,255,255,.82);
      --radius:24px;
      --shadow:0 20px 45px rgba(0,0,0,.35);
      --max:1120px;
      --space:clamp(14px,2vw,22px);
      --safe-top:max(14px, env(safe-area-inset-top));
      --safe-bottom:max(14px, env(safe-area-inset-bottom));
      --mx:0px;
      --my:0px;
    }
    *{box-sizing:border-box}
    html{scroll-behavior:smooth}
    body{margin:0;font-family:Inter,system-ui,sans-serif;color:var(--text);
      background:
      radial-gradient(60rem 60rem at 12% 8%, rgba(255,77,134,.24), transparent 60%),
      radial-gradient(55rem 55rem at 86% 20%, rgba(255,150,180,.18), transparent 60%),
      linear-gradient(160deg,var(--bg),var(--bg2));overflow-x:hidden}
    a{color:inherit}
    .bg-wrap{position:fixed;inset:0;z-index:-1;pointer-events:none;overflow:hidden}
    .bg-gradient{position:absolute;inset:-15%;filter:blur(38px);opacity:.85;
      background:
        radial-gradient(58rem 58rem at 15% 18%, rgba(255,77,134,.28), transparent 65%),
        radial-gradient(52rem 52rem at 82% 15%, rgba(255,150,180,.22), transparent 64%),
        radial-gradient(46rem 46rem at 60% 84%, rgba(255,208,222,.2), transparent 62%),
        linear-gradient(140deg, rgba(255,77,134,.12), rgba(255,150,180,.06), rgba(255,77,134,.1));
      transform:translate3d(calc(var(--mx) * .05), calc(var(--my) * .05), 0) scale(1.06);
      animation:drift 13s ease-in-out infinite alternate;
    }
    .blob{position:absolute;border-radius:50%;filter:blur(14px);opacity:.7}
    .blob.b1{width:34rem;height:34rem;left:-14rem;top:-9rem;background:radial-gradient(circle,rgba(255,150,180,.35),rgba(255,77,134,.1) 62%,transparent 72%);
      transform:translate3d(calc(var(--mx) * .08), calc(var(--my) * .08), 0);
      animation:blobShift 11s ease-in-out infinite alternate;
    }
    .blob.b2{width:40rem;height:40rem;right:-16rem;bottom:-15rem;background:radial-gradient(circle,rgba(255,208,222,.28),rgba(255,150,180,.08) 62%,transparent 72%);
      transform:translate3d(calc(var(--mx) * -.08), calc(var(--my) * -.08), 0);
      animation:blobShift 14s ease-in-out infinite alternate-reverse;
    }
    .grain{position:absolute;inset:-40%;opacity:.13;mix-blend-mode:overlay;
      background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='220' height='220'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.9' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='220' height='220' filter='url(%23n)' opacity='.55'/%3E%3C/svg%3E");
      animation:grainMove 6s steps(2) infinite;
    }
    @keyframes drift{from{transform:translate3d(-10px,8px,0) scale(1.05)}to{transform:translate3d(12px,-9px,0) scale(1.09)}}
    @keyframes blobShift{from{transform:translate3d(-12px,10px,0)}to{transform:translate3d(14px,-12px,0)}}
    @keyframes grainMove{0%{transform:translate(-3%,-2%)}40%{transform:translate(3%,2%)}100%{transform:translate(2%,-3%)}}
    #heartsCanvas{width:100%;height:100%;display:block}
    .container{width:min(var(--max),calc(100% - 2rem));margin-inline:auto}
    .nav{position:sticky;top:0;padding-top:var(--safe-top);z-index:12;backdrop-filter:blur(14px);background:rgba(16,8,16,.5);border-bottom:1px solid rgba(255,255,255,.1)}
    .nav-inner{display:flex;align-items:center;justify-content:space-between;gap:1rem;padding:.8rem 0}
    .brand{display:flex;align-items:center;gap:.6rem;font-weight:700}
    .brand i{display:grid;place-content:center;width:34px;height:34px;border-radius:50%;background:linear-gradient(145deg,var(--pink),var(--pink-2));box-shadow:var(--shadow)}
    .nav-links{display:flex;gap:1rem;font-size:.95rem;color:var(--text-soft)}
    .nav-links a{padding:.45rem .55rem;border-radius:9px}
    .nav-links a:focus-visible,.nav-links a:hover{outline:none;background:rgba(255,255,255,.1);color:#fff}
    .controls{display:flex;gap:.5rem}
    .icon-btn,.btn{border:0;color:#fff;cursor:pointer;touch-action:manipulation}
    .icon-btn{min-width:44px;min-height:44px;border-radius:999px;background:rgba(255,255,255,.1);display:grid;place-content:center;border:1px solid var(--stroke)}
    .icon-btn:focus-visible,.btn:focus-visible{outline:2px solid #fff;outline-offset:2px}
    main{padding-bottom:var(--safe-bottom)}
    section{padding:clamp(2.4rem,5vw,5rem) 0}
    .hero-grid{display:grid;grid-template-columns:1.1fr .9fr;gap:clamp(14px,2vw,22px);align-items:stretch}
    .glass{background:var(--card);border:1px solid var(--stroke);border-radius:var(--radius);backdrop-filter:blur(10px);box-shadow:var(--shadow)}
    .hero-card{padding:clamp(1.1rem,3vw,2rem)}
    .kicker{font-size:.75rem;letter-spacing:.14em;text-transform:uppercase;color:var(--text-soft);font-weight:700}
    .hero-title{font-size:clamp(2rem,6vw,4.2rem);line-height:1.02;margin:.5rem 0 0}
    .script{display:block;font-family:'Great Vibes',cursive;font-size:clamp(1.5rem,3.4vw,2.4rem);color:var(--pink-3);margin-top:.4rem}
    .type{display:block;min-height:2.6rem;font-size:clamp(1rem,2vw,1.2rem);color:var(--text-soft);margin:1rem 0}
    .hero-cta{display:flex;flex-wrap:wrap;gap:.7rem;align-items:center}
    .btn{padding:.8rem 1.1rem;border-radius:999px;font-weight:700;transition:transform .2s ease, background .2s ease, box-shadow .2s ease}
    .btn:hover{transform:translateY(-2px)}
    .btn:active{transform:translateY(0)}
    .btn-primary{background:linear-gradient(130deg,var(--pink),var(--pink-2));box-shadow:0 8px 26px rgba(255,77,134,.45)}
    .btn-ghost{background:rgba(255,255,255,.08);border:1px solid var(--stroke)}
    .stats{display:grid;gap:.8rem}
    .stat{padding:1rem}
    .stat b{font-size:clamp(1.5rem,3vw,2.1rem);display:block}
    .photo{overflow:hidden;border-radius:16px;border:1px solid var(--stroke)}
    .photo img{width:100%;height:260px;object-fit:cover;display:block;transform:scale(1.01);transition:transform .5s ease}
    .photo:hover img{transform:scale(1.06)}
    .section-head{display:flex;justify-content:space-between;align-items:end;margin-bottom:1rem;gap:1rem}
    .title{font-size:clamp(1.5rem,4vw,2.3rem);margin:.2rem 0}
    .subtitle{color:var(--text-soft)}
    .gallery-grid{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:.9rem}
    .card{position:relative;overflow:hidden;border-radius:18px;aspect-ratio:4/3;background:#000;border:1px solid var(--stroke);cursor:pointer;transition:transform .2s ease, box-shadow .2s ease}
    .card:hover{transform:translateY(-4px);box-shadow:var(--shadow)}
    .card img{width:100%;height:100%;object-fit:cover}
    .card .overlay{position:absolute;inset:auto 0 0;background:linear-gradient(transparent,rgba(0,0,0,.75));padding:.8rem .8rem .7rem;font-size:.9rem}
    .reasons{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:.8rem}
    .reason{padding:1rem;border-radius:16px;background:rgba(255,255,255,.09);border:1px solid var(--stroke)}
    .countdown-wrap{display:grid;grid-template-columns:repeat(4,minmax(0,1fr));gap:.7rem}
    .unit{padding:1rem;text-align:center}
    .unit b{font-size:clamp(1.5rem,4vw,2.2rem);display:block}
    .question{text-align:center}
    .actions{position:relative;display:flex;justify-content:center;align-items:center;gap:.8rem;min-height:180px;padding:1rem;border-radius:18px;overflow:hidden}
    #noBtn{position:relative}
    #finalMessage{margin-top:1rem;color:var(--pink-3);font-weight:700;min-height:1.3rem}
    .big-heart{font-size:clamp(3rem,10vw,6rem);animation:pulse 1.8s ease-in-out infinite;filter:drop-shadow(0 8px 22px rgba(255,77,134,.45))}
    @keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.12)}}
    .modal{position:fixed;inset:0;background:rgba(0,0,0,.7);display:none;align-items:center;justify-content:center;padding:1rem;z-index:20}
    .modal.open{display:flex}
    .modal-card{width:min(780px,100%);border-radius:20px;padding:1rem;background:rgba(25,11,24,.95);border:1px solid var(--stroke)}
    .modal-top{display:flex;justify-content:space-between;gap:1rem;align-items:center}
    .modal-close{background:rgba(255,255,255,.12);color:#fff;border:1px solid var(--stroke);border-radius:999px;min-width:44px;min-height:44px;cursor:pointer}
    .modal-media img{width:100%;border-radius:14px;max-height:65vh;object-fit:cover;margin-top:.8rem}
    .toast{position:fixed;left:50%;bottom:calc(var(--safe-bottom) + .8rem);transform:translateX(-50%) translateY(16px);opacity:0;transition:.3s ease;z-index:30}
    .toast.show{opacity:1;transform:translateX(-50%) translateY(0)}
    .toast .box{background:rgba(22,8,20,.9);border:1px solid var(--stroke);border-radius:999px;padding:.65rem .9rem}
    .floating-heart{position:fixed;pointer-events:none;font-size:1.2rem;animation:floatUp .95s ease-out forwards}
    @keyframes floatUp{to{transform:translateY(-70px) scale(1.2);opacity:0}}
    .reveal{opacity:0;transform:translateY(18px);transition:opacity .5s ease, transform .5s ease}
    .reveal.is-visible{opacity:1;transform:none}
    @media (max-width:900px){
      .hero-grid,.gallery-grid,.reasons{grid-template-columns:1fr}
      .countdown-wrap{grid-template-columns:repeat(2,minmax(0,1fr))}
      .nav-links{display:none}
    }
    @media (prefers-reduced-motion:reduce){
      *{animation:none!important;transition:none!important;scroll-behavior:auto!important}
      .reveal{opacity:1;transform:none}
      .bg-gradient,.blob,.grain{animation:none!important}
    }
  </style>
</head>

<body>
  <div class="bg-wrap" aria-hidden="true">
    <canvas id="heartsCanvas"></canvas>
    <div class="bg-gradient"></div>
    <div class="blob b1"></div>
    <div class="blob b2"></div>
    <div class="grain"></div>
  </div>

  <div class="toast" id="toast" aria-live="polite" aria-atomic="true">
    <div class="box" id="toastText">Message</div>
  </div>

  <header class="nav">
    <div class="container nav-inner">
      <div class="brand"><i aria-hidden="true">‚ù§</i> <span>Valentine Gift</span></div>
      <nav class="nav-links" aria-label="Sections">
        <a href="#gallery">Gallery</a><a href="#reasons">Reasons</a><a href="#countdown">Countdown</a><a href="#question">Question</a><a href="#finale">Finale</a>
      </nav>
      <div class="controls">
        <button class="icon-btn" id="btnMusic" type="button" aria-label="Toggle music">‚ô´</button>
        <button class="icon-btn" id="btnSound" type="button" aria-label="Play heartbeat">üíì</button>
      </div>
    </div>
  </header>

  <main>
    <section class="hero" id="top">
      <div class="container hero-grid">
        <article class="glass hero-card reveal">
          <div class="kicker" id="todayLabel">Special Day</div>
          <h1 class="hero-title">
            Happy Valentine‚Äôs Day ‚ù§Ô∏è
            <span class="script" id="heroScript">For my favorite person</span>
          </h1>
          <p class="type" id="typeTarget" aria-live="polite"></p>
          <div class="hero-cta">
            <button class="btn btn-primary" id="openHeart" type="button">Open My Heart ‚ú®</button>
            <a class="btn btn-ghost" href="#gallery">See Our Moments üì∏</a>
            <span class="subtitle">Tip: click anywhere for hearts üíû</span>
          </div>
          <p class="subtitle" id="heroNote" style="margin-top:1rem">
            You make my world softer, brighter, and warmer.
          </p>
        </article>

        <aside class="stats">
          <div class="glass stat reveal">
            <b id="statDays">‚Äî</b><span>Days since our first smile</span>
          </div>

          <div class="glass stat reveal">
            <b id="statHearts">‚àû</b><span>Hearts for you</span>
          </div>

          <div class="glass stat reveal">
            <div class="photo">
              <!-- featured: —É —Ç–µ–±—è –≤ —Ä–µ–ø–æ –Ω–µ—Ç featured.jpg, –ø–æ—ç—Ç–æ–º—É —Å—Ç–∞–≤–∏–º 1.jpg -->
              <img id="featuredImg" alt="Featured romantic photo" src="1.jpg">
            </div>
            <strong id="featuredTitle">Our little universe</strong>
            <p class="subtitle" id="featuredSub">This is our favorite photo üíó</p>
          </div>
        </aside>
      </div>
    </section>

    <section id="gallery">
      <div class="container">
        <div class="section-head reveal">
          <div>
            <div class="kicker">Gallery</div>
            <h2 class="title">Our moments in little frames</h2>
            <p class="subtitle">Tap any memory to open it.</p>
          </div>
        </div>
        <div class="gallery-grid" id="galleryGrid"></div>
      </div>
    </section>

    <section id="reasons">
      <div class="container">
        <div class="section-head reveal">
          <div>
            <div class="kicker">Reasons</div>
            <h2 class="title" id="reasonsTitle">10 reasons why I love you</h2>
          </div>
        </div>
        <div class="reasons" id="reasonsGrid"></div>
      </div>
    </section>

    <section id="countdown">
      <div class="container">
        <div class="section-head reveal">
          <div>
            <div class="kicker">Countdown</div>
            <h2 class="title">Until February 22 üíò</h2>
          </div>
        </div>
        <div class="countdown-wrap">
          <div class="glass unit"><b id="cdDays">00</b><span>Days</span></div>
          <div class="glass unit"><b id="cdHours">00</b><span>Hours</span></div>
          <div class="glass unit"><b id="cdMinutes">00</b><span>Minutes</span></div>
          <div class="glass unit"><b id="cdSeconds">00</b><span>Seconds</span></div>
        </div>
      </div>
    </section>

    <section id="question">
      <div class="container">
        <div class="glass question reveal">
          <h2 class="title">Do you love me?</h2>
          <p class="subtitle">Be honest... but I know the answer üíó</p>
          <div class="actions glass" id="loveArena">
            <button class="btn btn-primary" id="yesBtn" type="button">YES üíò</button>
            <button class="btn btn-ghost" id="noBtn" type="button">NO üôà</button>
          </div>
          <p id="finalMessage" aria-live="polite"></p>
        </div>
      </div>
    </section>

    <section id="finale">
      <div class="container">
        <div class="glass question reveal">
          <h2 class="title">Forever starts with little moments</h2>
          <p class="subtitle" id="finaleSub">Thank you for being my favorite chapter.</p>
          <div class="big-heart" aria-hidden="true">üíñ</div>
        </div>
      </div>
    </section>
  </main>

  <div class="modal" id="galleryModal" role="dialog" aria-modal="true" aria-labelledby="modalTitle" aria-describedby="modalDesc">
    <div class="modal-card" role="document">
      <div class="modal-top">
        <h3 id="modalTitle">Memory</h3>
        <button class="modal-close" id="modalClose" aria-label="Close gallery modal">‚úï</button>
      </div>
      <div class="modal-media"><img id="modalImage" alt="Selected memory"></div>
      <p id="modalDesc" class="subtitle"></p>
    </div>
  </div>

  <script>
  (() => {
    'use strict';

    // =========================
    // CONFIG: –ø–æ–¥ —Ç–≤–æ–∏ —Ñ–∞–π–ª—ã –≤ ROOT (–∫–∞–∫ —É —Ç–µ–±—è —Å–µ–π—á–∞—Å)
    // =========================
    const CONFIG = {
      names: { from: 'Alex', to: 'Sofia' },
      specialDate: '2025-09-22T18:27:00',

      // –æ—Å—Ç–∞–≤–ª—è–µ–º null ‚Äî –Ω–∏–∂–µ —Ñ—É–Ω–∫—Ü–∏—è —Å–∞–º–∞ —Å—á–∏—Ç–∞–µ—Ç –±–ª–∏–∂–∞–π—à–µ–µ 22 —Ñ–µ–≤—Ä–∞–ª—è
      targetDate: null,

      copy: {
        heroScript: 'For my favorite person',
        heroNote: 'I made this page to remind you that love can feel like home.',
        finaleSub: 'Thank you for being my favorite chapter.',
        reasonsTitle: '10 reasons why I love you',
        featuredTitle: 'Our little universe',
        featuredSub: 'This is our favorite photo üíó',
        typeLines: [
          'You + me = my favorite story.',
          'I still get butterflies.',
          'Every day with you is a gift.'
        ]
      },

      // –¢–í–û–ò –§–ê–ô–õ–´: 1.jpg 2.jpg 3.jpg 4.jpeg 5.jpeg 6.jpeg (–≤ –∫–æ—Ä–Ω–µ —Ä–µ–ø–æ)
      gallery: [
        { src:'1.jpg', title:'Photo 1', desc:'Our moment.' },
        { src:'2.jpg', title:'Photo 2', desc:'Our moment.' },
        { src:'3.jpg', title:'Photo 3', desc:'Our moment.' },
        { src:'4.jpeg', title:'Minecraft 1', desc:'Us in Minecraft.' },
        { src:'5.jpeg', title:'Minecraft 2', desc:'Us in Minecraft.' },
        { src:'6.jpeg', title:'Minecraft 3', desc:'Us in Minecraft.' }
      ],

      reasons: [
        'Your laugh is my favorite sound.',
        'You make hard days softer.',
        'You listen with your whole heart.',
        'You cheer me on without asking.',
        'You make simple moments magical.',
        'Your kindness inspires me.',
        'You understand me deeply.',
        'You make me brave.',
        'You feel like home.',
        'You are my favorite hello.'
      ]
    };

    const prefersReduced = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
    const $ = (sel, root=document) => root.querySelector(sel);
    const $$ = (sel, root=document) => Array.from(root.querySelectorAll(sel));
    const clamp = (n,min,max) => Math.max(min, Math.min(max, n));
    const throttle = (fn, wait=120) => { let t=0; return (...args)=>{const now=performance.now(); if(now-t>wait){t=now; fn(...args);} }; };

    const dom = {
      typeTarget: $('#typeTarget'), todayLabel: $('#todayLabel'), heroScript: $('#heroScript'), heroNote: $('#heroNote'),
      statDays: $('#statDays'),
      galleryGrid: $('#galleryGrid'), reasonsGrid: $('#reasonsGrid'),
      cd: {d:$('#cdDays'),h:$('#cdHours'),m:$('#cdMinutes'),s:$('#cdSeconds')},
      toast: $('#toast'), toastText: $('#toastText'),
      modal: $('#galleryModal'), modalClose: $('#modalClose'), modalImage: $('#modalImage'), modalTitle: $('#modalTitle'), modalDesc: $('#modalDesc'),
      openHeart: $('#openHeart'), question: $('#question'),
      yesBtn: $('#yesBtn'), noBtn: $('#noBtn'), loveArena: $('#loveArena'), finalMessage: $('#finalMessage'),
      musicBtn: $('#btnMusic'), soundBtn: $('#btnSound'), canvas: $('#heartsCanvas'),
      featuredTitle: $('#featuredTitle'), featuredSub: $('#featuredSub'),
      reasonsTitle: $('#reasonsTitle'),
      finaleSub: $('#finaleSub')
    };

    dom.heroScript.textContent = `${CONFIG.copy.heroScript} ‚Äî ${CONFIG.names.to}`;
    dom.heroNote.textContent = CONFIG.copy.heroNote;
    dom.featuredTitle.textContent = CONFIG.copy.featuredTitle;
    dom.featuredSub.textContent = CONFIG.copy.featuredSub;
    dom.reasonsTitle.textContent = CONFIG.copy.reasonsTitle;
    dom.finaleSub.textContent = CONFIG.copy.finaleSub;

    dom.todayLabel.textContent = new Date().toLocaleDateString(undefined, { weekday:'long', month:'long', day:'numeric' });
    dom.statDays.textContent = Math.max(0, Math.floor((Date.now() - new Date(CONFIG.specialDate).getTime()) / 86400000)).toString();

    const startTypewriter = () => {
      let line = 0, char = 0, deleting = false;
      const tick = () => {
        const text = CONFIG.copy.typeLines[line];
        dom.typeTarget.textContent = text.slice(0, char);
        if (!deleting) char++; else char--;
        if (char === text.length + 1) { deleting = true; return setTimeout(tick, 1100); }
        if (char < 0) { deleting = false; line = (line + 1) % CONFIG.copy.typeLines.length; char = 0; }
        setTimeout(tick, deleting ? 45 : 72);
      };
      tick();
    };

    const setupReveal = () => {
      const observer = new IntersectionObserver((entries) => {
        entries.forEach((entry) => entry.isIntersecting && entry.target.classList.add('is-visible'));
      }, { threshold: 0.18, rootMargin: '0px 0px -6% 0px' });
      $$('.reveal').forEach((el) => observer.observe(el));
    };

    let lastFocused = null;
    const FOCUSABLE = 'a[href],button:not([disabled]),textarea,input,select,[tabindex]:not([tabindex="-1"])';

    const openModal = (item, opener) => {
      lastFocused = opener || document.activeElement;
      dom.modalTitle.textContent = item.title;
      dom.modalDesc.textContent = item.desc;
      dom.modalImage.src = item.src;
      dom.modal.classList.add('open');
      document.body.style.overflow = 'hidden';
      dom.modalClose.focus();
    };
    const closeModal = () => {
      dom.modal.classList.remove('open');
      document.body.style.overflow = '';
      if (lastFocused) lastFocused.focus();
    };
    const trapModalFocus = (event) => {
      if (!dom.modal.classList.contains('open') || event.key !== 'Tab') return;
      const items = $$(FOCUSABLE, dom.modal);
      if (!items.length) return;
      const first = items[0], last = items[items.length - 1];
      if (event.shiftKey && document.activeElement === first) { event.preventDefault(); last.focus(); }
      else if (!event.shiftKey && document.activeElement === last) { event.preventDefault(); first.focus(); }
    };

    const renderGallery = () => {
      const frag = document.createDocumentFragment();
      CONFIG.gallery.forEach((item, idx) => {
        const card = document.createElement('button');
        card.type = 'button';
        card.className = 'card reveal';
        card.setAttribute('aria-label', `Open memory: ${item.title}`);
        card.innerHTML = `
          <img loading="lazy" src="${item.src}" alt="${item.title}">
          <div class="overlay">
            <strong>${idx+1}. ${item.title}</strong>
            <div>${item.desc}</div>
          </div>`;
        card.addEventListener('click', () => openModal(item, card));
        frag.append(card);
      });
      dom.galleryGrid.append(frag);
    };

    const renderReasons = () => {
      const frag = document.createDocumentFragment();
      CONFIG.reasons.forEach((reason, i) => {
        const el = document.createElement('article');
        el.className = 'reason reveal';
        el.innerHTML = `<strong>${i+1}.</strong> ${reason}`;
        frag.append(el);
      });
      dom.reasonsGrid.append(frag);
    };

    // =========================
    // COUNTDOWN: –ë–õ–ò–ñ–ê–ô–®–ò–ô 22 –§–ï–í–†–ê–õ–Ø (–∫–∞–∂–¥—ã–π –≥–æ–¥)
    // =========================
    const resolveCountdownTarget = () => {
      if (CONFIG.targetDate) return new Date(CONFIG.targetDate).getTime();

      const now = new Date();
      const year = now.getFullYear();

      // 22 —Ñ–µ–≤—Ä–∞–ª—è 00:00 —Ç–µ–∫—É—â–µ–≥–æ –≥–æ–¥–∞
      const feb22ThisYear = new Date(year, 1, 22, 0, 0, 0, 0); // 1 = February (0-based)

      // –µ—Å–ª–∏ —É–∂–µ –ø—Ä–æ—à–ª–æ ‚Äî –±–µ—Ä—ë–º —Å–ª–µ–¥—É—é—â–∏–π –≥–æ–¥
      const target = now > feb22ThisYear
        ? new Date(year + 1, 1, 22, 0, 0, 0, 0)
        : feb22ThisYear;

      return target.getTime();
    };

    const startCountdown = () => {
      const target = resolveCountdownTarget();
      const pad = (n) => String(n).padStart(2, '0');
      const tick = () => {
        const diff = Math.max(0, target - Date.now());
        const d = Math.floor(diff/86400000);
        const h = Math.floor(diff/3600000)%24;
        const m = Math.floor(diff/60000)%60;
        const s = Math.floor(diff/1000)%60;
        dom.cd.d.textContent = pad(d);
        dom.cd.h.textContent = pad(h);
        dom.cd.m.textContent = pad(m);
        dom.cd.s.textContent = pad(s);
      };
      tick(); setInterval(tick, 1000);
    };

    let noAttempts = 0;
    const showToast = (msg) => {
      dom.toastText.textContent = msg;
      dom.toast.classList.add('show');
      clearTimeout(showToast.timer);
      showToast.timer = setTimeout(() => dom.toast.classList.remove('show'), 1800);
    };

    const moveNoButton = () => {
      noAttempts += 1;
      if (noAttempts >= 5) {
        dom.finalMessage.textContent = 'Nice try üòè';
        dom.noBtn.disabled = true;
        dom.noBtn.style.opacity = '.5';
        return;
      }
      const arena = dom.loveArena.getBoundingClientRect();
      const btn = dom.noBtn.getBoundingClientRect();
      const maxX = Math.max(6, arena.width - btn.width - 10);
      const maxY = Math.max(6, arena.height - btn.height - 10);
      const x = clamp(Math.random() * maxX, 6, maxX);
      const y = clamp(Math.random() * maxY, 6, maxY);
      dom.noBtn.style.position = 'absolute';
      dom.noBtn.style.left = `${x}px`;
      dom.noBtn.style.top = `${y}px`;
      showToast('Nope button unlocked parkour mode üí®');
    };

    const launchConfetti = () => {
      for (let i=0;i<65;i++) {
        const el = document.createElement('span');
        el.textContent = ['üíñ','‚ú®','üíó','üíï'][i%4];
        el.className = 'floating-heart';
        el.style.left = `${Math.random()*100}%`;
        el.style.top = `${50 + Math.random()*30}%`;
        el.style.animationDuration = `${0.8 + Math.random()*1.1}s`;
        document.body.append(el);
        setTimeout(() => el.remove(), 1500);
      }
    };

    dom.yesBtn.addEventListener('click', () => {
      dom.finalMessage.textContent = 'You said YES üíò Best day ever.';
      launchConfetti();
      showToast('Heart officially over the moon!');
    });
    dom.noBtn.addEventListener('pointerenter', moveNoButton, { passive:true });
    dom.noBtn.addEventListener('pointerdown', moveNoButton, { passive:true });
    dom.noBtn.addEventListener('click', moveNoButton);

    document.addEventListener('pointerdown', throttle((e) => {
      if (e.target.closest('button,a,.modal')) return;
      const heart = document.createElement('span');
      heart.className = 'floating-heart';
      heart.textContent = ['üíó','üíñ','üíò'][Math.floor(Math.random()*3)];
      heart.style.left = `${e.clientX - 10}px`;
      heart.style.top = `${e.clientY - 12}px`;
      document.body.append(heart);
      setTimeout(() => heart.remove(), 1000);
    }, 90), { passive:true });

    const setupCanvasHearts = () => {
      const ctx = dom.canvas.getContext('2d', { alpha:true });
      let hearts = []; let raf = 0;

      const resize = () => {
        const dpr = Math.min(window.devicePixelRatio || 1, 2);
        const w = window.innerWidth, h = window.innerHeight;
        dom.canvas.width = Math.floor(w * dpr);
        dom.canvas.height = Math.floor(h * dpr);
        dom.canvas.style.width = `${w}px`;
        dom.canvas.style.height = `${h}px`;
        ctx.setTransform(dpr,0,0,dpr,0,0);

        const count = Math.round((w * h) / 25000);
        hearts = Array.from({length:count}, () => ({
          x:Math.random()*w,
          y:Math.random()*h,
          s:Math.random()*10+8,
          vy:Math.random()*.6+.3,
          sway:Math.random()*2-1,
          a:Math.random()*.5+.25
        }));
      };

      const draw = () => {
        ctx.clearRect(0,0,window.innerWidth,window.innerHeight);
        hearts.forEach((h) => {
          h.y += h.vy;
          h.x += Math.sin(h.y * 0.01) * h.sway * 0.22;
          if (h.y > window.innerHeight + 20) { h.y = -20; h.x = Math.random() * window.innerWidth; }
          ctx.globalAlpha = h.a;
          ctx.fillStyle = '#ff8fb4';
          ctx.font = `${h.s}px Inter`;
          ctx.fillText('‚ù§', h.x, h.y);
        });
        raf = requestAnimationFrame(draw);
      };

      resize();
      draw();
      window.addEventListener('resize', throttle(resize, 140), { passive:true });
      window.addEventListener('beforeunload', () => cancelAnimationFrame(raf), { once:true });
    };

    // =========================
    // MUSIC: Romantic Jazz (soft chords)
    // =========================
    const audio = (() => {
      let ctx = null;
      let playing = false;
      let interval = null;
      let heartbeatEnabled = true;

      const getCtx = () => ctx || (ctx = new (window.AudioContext || window.webkitAudioContext)());

      const playNote = (freq, duration = 0.55, type = 'triangle', volume = 0.035) => {
        const c = getCtx();
        const osc = c.createOscillator();
        const gain = c.createGain();

        osc.type = type;
        osc.frequency.value = freq;

        const t = c.currentTime;
        gain.gain.setValueAtTime(0.0001, t);
        gain.gain.linearRampToValueAtTime(volume, t + 0.03);
        gain.gain.linearRampToValueAtTime(0.0001, t + duration);

        osc.connect(gain);
        gain.connect(c.destination);

        osc.start();
        osc.stop(t + duration + 0.02);
      };

      const chords = [
        [261.63, 329.63, 392.00, 493.88], // Cmaj7
        [293.66, 349.23, 440.00, 523.25], // Dm7
        [329.63, 392.00, 493.88, 587.33], // Em7
        [349.23, 440.00, 523.25, 659.25], // Fmaj7
        [392.00, 493.88, 587.33, 698.46], // G7-ish
        [440.00, 523.25, 659.25, 783.99]  // Am7-ish
      ];

      const toggleMusic = () => {
        playing = !playing;
        dom.musicBtn.style.background = playing ? 'rgba(255,77,134,.35)' : 'rgba(255,255,255,.1)';

        if (!playing) {
          clearInterval(interval);
          interval = null;
          return;
        }

        let i = 0;
        interval = setInterval(() => {
          const chord = chords[i % chords.length];
          chord.forEach((f, idx) => playNote(f, 0.7, 'triangle', 0.03 - idx*0.002));
          i++;
        }, 1100);
      };

      const beep = (freq=440, dur=.11, type='sine', gainValue=.06) => {
        const c = getCtx();
        const o = c.createOscillator(); const g = c.createGain();
        o.type = type; o.frequency.value = freq; g.gain.value = gainValue;
        o.connect(g); g.connect(c.destination); o.start(); o.stop(c.currentTime + dur);
      };
      const playHeartbeat = () => { beep(74,.08,'sawtooth',.08); setTimeout(() => beep(62,.08,'sawtooth',.065), 140); };
      const toggleHeartbeat = () => {
        heartbeatEnabled = !heartbeatEnabled;
        dom.soundBtn.style.background = heartbeatEnabled ? 'rgba(255,77,134,.35)' : 'rgba(255,255,255,.1)';
        dom.soundBtn.setAttribute('aria-pressed', String(heartbeatEnabled));
        if (heartbeatEnabled) playHeartbeat();
      };
      const heartbeatIfEnabled = () => heartbeatEnabled && playHeartbeat();

      return { toggleMusic, toggleHeartbeat, heartbeatIfEnabled };
    })();

    const triggerMiniBurst = () => {
      const burstCount = prefersReduced ? 12 : 24;
      for (let i = 0; i < burstCount; i++) {
        const el = document.createElement('span');
        el.textContent = ['üíñ', '‚ú®', 'üíó', 'üíï'][i % 4];
        el.className = 'floating-heart';
        el.style.left = `${45 + Math.random() * 10}%`;
        el.style.top = `${42 + Math.random() * 22}%`;
        el.style.animationDuration = `${prefersReduced ? .5 : (0.65 + Math.random() * .5)}s`;
        document.body.append(el);
        setTimeout(() => el.remove(), prefersReduced ? 700 : 1200);
      }
    };

    const openHeartInteraction = () => {
      audio.heartbeatIfEnabled();
      triggerMiniBurst();
      dom.question.scrollIntoView({ behavior: prefersReduced ? 'auto' : 'smooth', block: 'start' });
    };

    const setupParallax = () => {
      if (prefersReduced) return;
      const onMove = throttle((event) => {
        const x = (event.clientX / window.innerWidth - 0.5) * 24;
        const y = (event.clientY / window.innerHeight - 0.5) * 24;
        document.documentElement.style.setProperty('--mx', `${x.toFixed(2)}px`);
        document.documentElement.style.setProperty('--my', `${y.toFixed(2)}px`);
      }, 24);
      window.addEventListener('pointermove', onMove, { passive: true });
    };

    dom.musicBtn.addEventListener('click', audio.toggleMusic);
    dom.soundBtn.addEventListener('click', audio.toggleHeartbeat);
    dom.openHeart.addEventListener('click', openHeartInteraction);
    dom.modalClose.addEventListener('click', closeModal);
    dom.modal.addEventListener('click', (e) => { if (e.target === dom.modal) closeModal(); });
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && dom.modal.classList.contains('open')) closeModal();
      trapModalFocus(e);
    });

    renderGallery();
    renderReasons();
    setupReveal();
    startTypewriter();
    startCountdown();
    setupCanvasHearts();
    setupParallax();
    if (prefersReduced) dom.canvas.style.opacity = '.4';
    dom.soundBtn.setAttribute('aria-pressed', 'true');
  })();
  </script>
</body>
</html>
